{% extends 'base.html' %}

{% block title %}
  Boletim
{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
  <h2 class="font-base text-3xl md:text-4xl font-bold text-white">ðŸ“˜ Boletim</h2>

  <form action="{{ url_for('boletim') }}" method="get" class="w-full md:w-auto">
    <label for="periodo" class="block text-lg font-medium text-white">Escolha o perÃ­odo:</label>
    <div class="mt-1 flex flex-col sm:flex-row rounded-lg overflow-hidden shadow-md">
      <select id="periodo" name="periodo" class="flex-1 block rounded-none bg-gray-700 text-white sm:text-sm p-2 focus:ring-2 focus:ring-teal-500">
        <option value="2022.1" {% if selected_periodo == '2022.1' %}selected{% endif %}>2022.1</option>
        <option value="2023.1" {% if selected_periodo == '2023.1' %}selected{% endif %}>2023.1</option>
        <option value="2024.1" {% if selected_periodo == '2024.1' %}selected{% endif %}>2024.1</option>
        <option value="2025.1" {% if selected_periodo == '2025.1' %}selected{% endif %}>2025.1</option>
      </select>
      <button type="submit" class="bg-teal-800 px-4 py-2 text-sm font-medium text-white hover:opacity-90 focus:ring-2 focus:ring-teal-400">
        Filtrar
      </button>
    </div>
  </form>
</div>

<div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3 mt-8">
  {% for data in boletim_data %}
  <div class="rounded-2xl bg-white/10 backdrop-blur-md p-6 text-white shadow-xl border border-teal-600/30">

    <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
      <h1 class="text-lg font-bold">{{ data.disciplina }}</h1>
      {% if data.situacao == 'Aprovado' %}
        <span class="rounded-full bg-green-500/20 px-4 py-1 text-xs text-green-400 font-semibold">{{ data.situacao }}</span>
      {% elif data.situacao == 'Cursando' %}
        <span class="rounded-full bg-yellow-500/20 px-4 py-1 text-xs text-yellow-400 font-semibold">{{ data.situacao }}</span>
      {% else %}
        <span class="rounded-full bg-red-500/20 px-4 py-1 text-xs text-red-400 font-semibold">{{ data.situacao }}</span>
      {% endif %}
    </div>

    <div class="mt-5 space-y-2 text-sm md:text-base">
      <p><span class="font-semibold">CH:</span> {{ data.carga_horaria }}H</p>
      <p><span class="font-semibold">Aulas:</span> {{ data.carga_horaria_cumprida }}/{{ data.carga_horaria }}</p>
      <div>
        <span class="font-semibold">FrequÃªncia:</span>
        <div class="w-full bg-gray-700 rounded-full h-3 mt-1">
          <div class="h-3 rounded-full 
            {% if data.percentual_carga_horaria_frequentada > 75 %}
              bg-green-500
            {% else %}
              bg-red-500
            {% endif %}
          " style="width: {{ data.percentual_carga_horaria_frequentada }}%"></div>
        </div>
        <span class="text-sm text-gray-300">{{ data.percentual_carga_horaria_frequentada }}% de frequÃªncia</span>
      </div>
    </div>

    <div class="mt-6">
      <p class="mb-3 font-semibold text-gray-200">Notas</p>
      <div class="flex flex-wrap gap-2">

        {% set nota_e1 = data.nota_etapa_1.nota if data.nota_etapa_1 is not none and data.nota_etapa_1.nota is not none else -1 %}
        <span class="px-3 py-2 rounded-lg text-sm font-bold
          {% if nota_e1 == -1 %} bg-gray-600 text-gray-300
          {% elif nota_e1 > 60 %} bg-teal-600 text-white
          {% elif nota_e1 > 40 %} bg-yellow-500 text-black
          {% else %} bg-red-600 text-white {% endif %}
        ">E1: {{ data.nota_etapa_1.nota if nota_e1 != -1 else 'N/A' }}</span>

        {% set nota_e2 = data.nota_etapa_2.nota if data.nota_etapa_2 is not none and data.nota_etapa_2.nota is not none else -1 %}
        <span class="px-3 py-2 rounded-lg text-sm font-bold
          {% if nota_e2 == -1 %} bg-gray-600 text-gray-300
          {% elif nota_e2 > 60 %} bg-teal-600 text-white
          {% elif nota_e2 > 40 %} bg-yellow-500 text-black
          {% else %} bg-red-600 text-white {% endif %}
        ">E2: {{ data.nota_etapa_2.nota if nota_e2 != -1 else 'N/A' }}</span>

        {% set nota_e3 = data.nota_etapa_3.nota if data.nota_etapa_3 is not none and data.nota_etapa_3.nota is not none else -1 %}
        <span class="px-3 py-2 rounded-lg text-sm font-bold
          {% if nota_e3 == -1 %} bg-gray-600 text-gray-300
          {% elif nota_e3 > 60 %} bg-teal-600 text-white
          {% elif nota_e3 > 40 %} bg-yellow-500 text-black
          {% else %} bg-red-600 text-white {% endif %}
        ">E3: {{ data.nota_etapa_3.nota if nota_e3 != -1 else 'N/A' }}</span>

        {% set nota_e4 = data.nota_etapa_4.nota if data.nota_etapa_4 is not none and data.nota_etapa_4.nota is not none else -1 %}
        <span class="px-3 py-2 rounded-lg text-sm font-bold
          {% if nota_e4 == -1 %} bg-gray-600 text-gray-300
          {% elif nota_e4 > 60 %} bg-teal-600 text-white
          {% elif nota_e4 > 40 %} bg-yellow-500 text-black
          {% else %} bg-red-600 text-white {% endif %}
        ">E4: {{ data.nota_etapa_4.nota if nota_e4 != -1 else 'N/A' }}</span>

        {% set nota_md = data.media_final_disciplina|int if data.media_final_disciplina is not none else -1 %}
        <span class="px-3 py-2 rounded-lg text-sm font-bold
          {% if nota_md == -1 %} bg-gray-600 text-gray-300
          {% elif nota_md >= 60 %} bg-teal-600 text-white
          {% else %} bg-red-600 text-white {% endif %}
        ">MD: {{ data.media_final_disciplina if nota_md != -1 else 'N/A' }}</span>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}